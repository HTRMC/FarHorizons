#version 450

layout(local_size_x = 64) in;

struct DrawCommand {
    uint indexCount;
    uint instanceCount;
    uint firstIndex;
    int  vertexOffset;
    uint firstInstance;
};

layout(set = 0, binding = 0) buffer DrawCommands {
    DrawCommand commands[];
} drawCommands;

layout(set = 0, binding = 1) buffer DrawCount {
    uint count;
} drawCount;

layout(push_constant) uniform PushConstants {
    uint objectCount;
    uint totalIndexCount;
} pc;

void main() {
    uint index = gl_GlobalInvocationID.x;

    if (index >= pc.objectCount) {
        return;
    }

    uint outIndex = atomicAdd(drawCount.count, 1);

    drawCommands.commands[outIndex].indexCount = pc.totalIndexCount;
    drawCommands.commands[outIndex].instanceCount = 1;
    drawCommands.commands[outIndex].firstIndex = 0;
    drawCommands.commands[outIndex].vertexOffset = 0;
    drawCommands.commands[outIndex].firstInstance = 0;
}
